

Somatic exome workflow based on [mgi-somatic-exome](https://github.com/sysamgen/analysis-workflows/blob/master/definitions/pipelines/somatic_exome.cwl).

### Introduction
Somatic_exome is designed to perform processing of mutant/wildtype H.sapiens
exome sequencing data. It features BQSR corrected alignments, 4 caller variant
detection, and vep style annotations. Structural variants are detected via
manta and cnvkit. In addition QC metrics are run, including
somalier concordance metrics.


### Alignment and QC step

Pipeline starts with either fastq files or unaligned BAM files with necessary metadata describing analysis type, sample name, gender, distinction between tumor and normal.

This step is performed seperately for normal and tumor sample.

.. image:: img/somatic-exome/alignment_qc.png

Used tools:
* [bwa_mem 0.7.15](10.1093/bioinformatics/btp324) - for sequence alignment step using GRCh38 reference
* [samblaster 0.1.24](https://doi.org/10.1093/bioinformatics/btu314) - for adding mate tags
* [flexbar 3.5](10.3390/biology1030895) - for bar and adapter removal 
* [picard:2.23.6](http://broadinstitute.github.io/picard/) for alignment metrics
* [samtools 1.11--h6270b1f_0](10.1093/bioinformatics/btp352) for BAM indexing and flagstat operation
* [picard 2.18.1](http://broadinstitute.github.io/picard/) - for bedtointervals operation
* [gatk 4.1.8.1](10.1101/gr.107524.110)  for Select Variants
* [verifyBamId v1.1.3](doi:10.1016/j.ajhg.2012.09.004) - for checking whether the reads are contaminated as a mixture of two samples
* [fastqc](https://www.bioinformatics.babraham.ac.uk/projects/fastqc/) - for bam QC report
* [qualimap](10.1093/bioinformatics/btv566) - for bam QC report
* [multiqc](10.1093/bioinformatics/btw354) - QC 


### Detect variants step
This step is performed for normal and tumor sample at once.
Once variants are standardized they are annotated with metadata collected and published by public databases. 
In the afterburner step final postprocessing is performed including generating URLs to external databases and extracting genotype information from INFO field.

.. image:: img/somatic-exome/detect_variants.png

Used tools:
* [mutect 2](https://doi.org/10.1038/nbt.2514) - for somatic variants detection
* [strelka 2.9.9](10.1038/s41592-018-0051-x) - for somatic variants (SNPs and indels) detection
* [varscan 2.4.2](10.1101/gr.129684.111) - for somatic variants detection
* [manta 1.6.0](10.1093/bioinformatics/btv710) - for somatic structural variants detection
* [cnvkit 0.9.8](https://doi.org/10.1371/journal.pcbi.1004873) - for copy number variants detection
* [vt 0.57721--hf74b74d_1](https://doi.org/10.1093/bioinformatics/btv112) - for normalization and decomposition
* [bcftools 1.12](10.1093/gigascience/giab008) - for vcf manipulations (merging, renaming samples)
* [samtools 1.11](10.1093/bioinformatics/btp352)  - for indexing and sanitizing BAM files (removing mutect-specific format tags, removing non ACTGN bases)
* [gatk 4.1.8.1](10.1101/gr.107524.110) - for DOCM variants detection and selecting, filtering variants
* [bcftools](10.1093/gigascience/giab008) - QC for detected variants


